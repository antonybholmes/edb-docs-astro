---
import DocPost from '@/components/help/DocPost.astro'
import { buildNodeTree, DOCS_DIR, type DocNode } from '@/lib/docs'
import { getCollection, type CollectionEntry } from 'astro:content'

export async function getStaticPaths() {
  const [rootNode, orderedSlugs] = await buildNodeTree(DOCS_DIR)

  console.log(orderedSlugs)

  const posts = await getCollection('docs')
  return posts.map((post) => {
    console.log(post.id)

    const idx = orderedSlugs.findIndex((s) => s.slug === post.id)

    const nextSlug = orderedSlugs[idx + 1]
    const prevSlug = orderedSlugs[idx - 1]

    return {
      params: { slug: post.id },
      props: { post, rootNode, nextSlug, prevSlug },
    }
  })
}

type Props = {
  post: CollectionEntry<'docs'>
  rootNode: DocNode
  nextSlug?: { slug: string; title: string }
  prevSlug?: { slug: string; title: string }
}

const { slug } = Astro.params
const { post, rootNode, nextSlug, prevSlug } = Astro.props
---

<DocPost
  post={post}
  rootNode={rootNode}
  slug={slug.split('/')}
  nextSlug={nextSlug}
  prevSlug={prevSlug}
/>
