---
import DocPost from '@/components/help/DocPost.astro'
import { buildNodeTree, DOCS_DIR, type DocNode } from '@/lib/docs'
import { getCollection, type CollectionEntry } from 'astro:content'

export async function getStaticPaths() {
  const rootNode = await buildNodeTree(DOCS_DIR)

  const posts = await getCollection('docs')
  return posts.map((post) => ({
    params: { slug: post.id },
    props: { post, rootNode },
  }))
}

type Props = { post: CollectionEntry<'docs'>; rootNode: DocNode }

const { slug } = Astro.params
const { post, rootNode } = Astro.props
---

<DocPost post={post} rootNode={rootNode} slug={slug.split('/')} />
